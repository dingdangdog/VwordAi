# 基于AI的长文本解析与JSON输出的提示词工程设计

**1. 引言**

人工智能在自然语言处理领域的进步，为分析复杂文本数据（如长篇小说）带来了前所未有的潜力。其中，识别叙事文本中的说话者以及理解文本的情感色彩，对于深入分析文学作品、理解人物互动和情感变化具有重要的价值。要有效地利用大型语言模型（LLMs）完成这些任务，精确的提示词工程至关重要。精心设计的提示词能够引导AI准确地提取所需信息，并以用户期望的格式输出，从而为后续的数据处理和分析奠定坚实的基础。本报告旨在提供一个详细的AI提示词工程设计方案，以满足用户将长文本解析为包含说话者和语气等情景标签的JSON格式的需求，并确保所设计的提示词可以直接投入使用。

**2. 需求理解**

用户的核心需求是对长度约为2000到5000字的小说章节进行分析，目标是识别每一句话的说话者和语气（或情绪），并将分析结果以JSON格式输出。这种结构化的输出便于用户进行后续的各种数据处理和分析。用户特别强调需要一个详细的AI提示词工程设计，并希望能够直接使用所提供的提示词。JSON格式的输出对于系统集成和自动化处理至关重要，因为它提供了一种标准化的数据交换格式。

**3. 信息抽取提示词工程的关键概念**

提示词工程是一门艺术与科学，它涉及到为AI模型设计有效的指令，以获取期望的信息 。提示词的质量直接影响着信息抽取的准确性和一致性 。根据研究材料，以下是一些关键的提示词工程最佳实践：  

清晰、具体和详尽地描述期望的上下文、结果、长度、格式和风格等 。模糊的提示词会导致结果不一致 。明确性能够确保AI理解任务的细微差别，从而提高分析的准确性。如果AI没有明确的指令，它可能会做出不必要的假设，导致输出与预期不符。详细的提示词能够减少AI的不确定性。  

将指令放在提示词的开头，并使用`###`或`"""`等分隔符将指令与文本内容分开 。这有助于AI清晰地区分任务要求和输入数据。将指令放在前面能够引导AI在处理文本之前首先关注任务目标，分隔符则进一步增强了这种区分。  

通过示例清晰地表达期望的输出格式 。模型在复制结构方面表现出色 。提供示例能够显著提高结构化输出的准确性。与其仅仅描述JSON格式，不如向AI展示期望的JSON结构示例，这能使其更容易理解并生成符合要求的输出。  

从零样本提示开始，如果效果不佳，再尝试少量样本提示 。微调是针对复杂场景的最后手段 。零样本提示利用模型预训练的知识，而少量样本提示则通过提供额外的上下文来指导模型输出 。从简单的方法开始可以节省计算资源和精力，只有在必要时才考虑更复杂的技术。  

减少冗余和不精确的描述，使用清晰和明确的语言 。提示词中的歧义会导致结果不一致 。就像人类指令一样，清晰对于AI至关重要。避免使用术语和模糊的措辞能够确保AI正确理解提示词。  

积极地表达指令，说明应该做什么，而不是不应该做什么 。积极的措辞通常更能有效地引导模型的行为。告诉AI应该做什么比告诉它不应该做什么更直接，也更不容易引起误解。  

使用领域特定的语言 。例如，在文学分析的场景中，使用“说话者”、“语气”、“情绪”、“话语”等术语。这有助于AI更有效地理解任务的背景。使用领域内熟悉的术语能够帮助AI从其训练数据中检索相关知识。  

指定约束条件，例如输出格式、长度或响应类型 。约束条件有助于确保输出符合用户的特定需求。通过设置限制，AI可以专注于最相关的信息和格式。  

迭代和优化提示词。提示词工程是一个迭代的过程，需要根据模型的输出来实验和改进不同的提示词 。持续的测试和调整是优化提示词性能的关键 。最初的提示词可能并不完美，通过分析AI的响应并进行调整，可以逐步改进提示词。  

考虑信息可能表达的各种方式 。例如，说话者可能通过姓名、代词或角色来指代，语气和情绪可以通过各种描述性词语和句子结构来表达。自然语言是多样的，提示词应该能够处理表达方式的变化。  

有效的提示词工程是艺术和科学的结合，既需要创造力，也需要对技术有深入的理解 。没有一个完美的提示词，它通常涉及到实验以及对任务和AI模型能力的深刻理解。  

**4. 设计说话者识别的提示词**

识别叙事文本中的说话者是一项具有挑战性的任务，需要考虑显式提及（例如，“爱丽丝说：”）和隐式线索（例如，对话流、人物背景）。以下是几种用于说话者识别的提示结构：

**基本指令：** 从一个清晰的指令开始，例如：“识别以下文本中每句话的说话者。”这符合从简单开始的原则 。  

**添加上下文：** 如果已知故事中涉及的人物，提供相关背景信息。例如：“以下是爱丽丝和鲍勃之间的对话。”提供相关的上下文能够指导信息抽取过程 。预先了解潜在的说话者可以显著提高准确性。AI可以利用提供的角色信息来更好地归属对话。  

**指定输出格式：** 清晰地指示AI如何在JSON输出中格式化说话者信息。例如，为每个句子对象指定一个名为“speaker”的字段。明确期望的输出格式至关重要 。  

**使用少量样本示例：** 提供一些文本片段示例，其中包含正确识别的说话者和期望的JSON格式。示例有助于阐明意图并提供参考点 。模型可以从示例中学习 。这对于指导AI处理隐式的说话者转换或特定的对话模式尤其有效。通过向AI展示如何在几个实例中正确识别说话者，它可以学习将这种模式推广到文本的其余部分。  

**处理歧义：** 指示AI如何处理说话者不明确的情况（例如，分配一个通用标签，如“说话者1”或指示“未知”）。提示词应包含处理缺失信息的错误处理机制 。这确保了所有句子都能被处理，即使说话者身份不确定。与其无法处理不明确的句子，不如让AI使用占位符标签，以便稍后进行人工审查。  

说话者识别可以被视为一个分类任务，其中每个句子都需要被分类到特定的说话者标签下 。将问题定义为分类有助于利用适当的提示词工程技术。  

**5. 设计语气和情绪分析的提示词**

语气是指作者对主题或人物的态度，而情绪是指为读者创造的感觉或氛围 。用户的需求似乎更倾向于识别每句话所传达的情感状态或感觉，这更接近于情绪，但也可能包含局部语气的元素。为简单起见，我们可以将它们一起视为每句话的“情感背景”。以下是句子层面语气/情绪分析的提示策略：  

**基本指令：** 指示AI“识别以下文本中每句话的语气或情绪。”从清晰的目标开始 。  

**提供类别：** 提供与文学分析相关的常见语气或情绪的预定义列表（例如，快乐、悲伤、愤怒、恐惧、好奇、正式、非正式）。指示AI为每句话选择最合适的类别。明确期望的结果 。将文本分类到预定义的类别中 。提供类别有助于标准化输出，并使其更易于后续分析。如果没有预定义的类别，AI可能会输出各种自由形式的语气/情绪描述，使得跨文本进行比较和分析更加困难。  

**情感分析方法：** 将任务定义为情感分析，要求AI将每句话分类为正面、负面或中性，甚至使用更细粒度的情感尺度 。情感分析是一项成熟的自然语言处理任务 。情感可以是句子整体语气或情绪的关键组成部分。虽然不直接是“语气”或“情绪”，但情感提供了关于文本情感色彩的宝贵信息。  

**结合说话者和语气/情绪：** 在提示词中，明确指示AI识别每句话的说话者和语气/情绪。这确保了AI在分析过程中同时考虑这两个方面。通过在单个提示词中结合这两个任务，可以提高效率，并确保在确定语气/情绪时考虑说话者的背景。

**使用少量样本示例：** 提供一些示例句子，其中包含已识别的语气/情绪（最好也包含说话者），并采用期望的JSON格式。示例清晰地表达了期望的输出 。这可以指导AI识别不同语气/情绪的细微线索。与说话者识别类似，示例可以教会AI将特定的语言模式与特定的情感状态联系起来。  

语气和情绪分析可能很复杂，因为存在讽刺、反语和主观解释 。提示词应承认这种潜在的细微差别。虽然目标是准确性，但重要的是要认识到语气和情绪分析即使对于人类来说也可能是主观的。提示词应引导AI根据文本做出合理的推断。  

**6. 以JSON格式构建输出**

用户的需求是JSON输出，这对于结构化数据表示和后续处理非常有利 。以下是如何指示AI以JSON格式输出的指南：  

**明确说明期望的格式：** 包括诸如“以JSON格式输出分析结果”之类的指令 。  

**定义JSON模式：** 清晰地描述期望的JSON对象或数组的结构。例如，句子对象数组，其中每个对象包含“sentence”、“speaker”和“tone_mood”字段 。告诉LLM你想要什么 。一个定义良好的模式能够确保一致性并方便解析输出。通过指定字段名称和数据类型，AI能够准确地知道如何构建提取的信息。  

**提供JSON示例：** 包含一个示例JSON输出，展示期望的结构和示例数据 。通过示例清晰地表达期望的输出格式 。模型在复制结构方面表现出色 。这通常是指导AI生成正确JSON格式的最有效方法。一个具体的示例不会留下任何关于JSON结构方式的歧义。  

**如果可用，使用系统级指令：** 如果使用像OpenAI这样的API，利用系统提示来加强对JSON输出的要求 。如果可用，使用系统提示指令 。系统提示设置了AI模型的整体行为。这为整个交互过程提供了关于JSON输出的持久指令。  

**指示仅输出有效的JSON：** 添加一个约束条件，例如：“确保输出是有效的JSON，不包含任何额外的文本或解释” 。仅响应有效的JSON 。这可以防止AI包含可能干扰JSON解析的对话元素或Markdown格式。目标是获得干净、可解析的JSON数据。  



**建议的JSON模式：**

JSON

```
[
  {
    "sentence": "你好吗？",
    "speaker": "爱丽丝",
    "tone_mood": "友好"
  },
  {
    "sentence": "我很好，谢谢。",
    "speaker": "鲍勃",
    "tone_mood": "中性"
  }
  //... 更多句子
]
```

这种结构清晰简洁，适合表示分析结果。句子对象数组是表示文本顺序性质的自然方式，每个对象都包含该句子的分析结果。

**7. 处理长文本和潜在挑战**

处理可能超出某些LLM上下文窗口限制的长文本是一个挑战 。以下是处理长文本的策略：  

**分块：** 将长文本分割成更小的、可管理的块（例如，按段落或章节），并独立处理每个块 。将大的、模糊的任务分解成多个更小的、更清晰的步骤 。对长文档使用分块方法 。这允许处理超出模型上下文限制的文本。通过分解文本，可以在模型的容量范围内分析每个部分。  

**跨块维护上下文：** 如果使用分块，请考虑如何在说话者识别和语气/情绪分析中维护块之间的上下文。这可能需要在当前块的提示中包含前一个块的几个前导句子。上下文对于准确分析至关重要，尤其是基于对话流的说话者识别。在块之间包含一些重叠有助于AI理解叙述的连贯性。

**迭代摘要（与此特定任务的相关性较低，但值得简要提及）：** 对于非常长的文本，可以考虑迭代地总结各个部分，然后分析摘要，但这可能会丢失用户所需的句子级细节 。  

在实现准确的说话者和语气/情绪识别方面，存在以下潜在挑战：

**歧义：** 当说话者没有明确提及或对话流复杂时，说话者识别可能具有挑战性 。歧义是信息抽取中的一个挑战 。  

**隐含信息：** 语气和情绪可以通过词语选择和句子结构的细微之处来传达，需要AI理解语言的细微差别 。由于人类语言的复杂性，自然语言处理算法可能难以准确地解释文本数据 。  

**格式不一致：** 文本中对话格式的变化可能会使AI难以一致地识别说话者。格式不一致是文本信息抽取中的一个挑战 。  

**语气和情绪的主观性：** 识别语气和情绪可能是主观的，不同的人可能有不同的感知 。AI分析可能并不总是与人类的解释完全一致。重要的是要对语气和情绪分析的准确性设定切合实际的期望。  

**保持一致性：** 确保AI在整个文本中一致地应用相同的语气/情绪标签可能是一个挑战。提示词的清晰性和具体性可以提高一致性 。  

LLM训练数据中的偏差可能会影响语气/情绪分析 。了解潜在的偏差对于解释结果非常重要。  

**8. 迭代提示优化和示例**

提示词工程是一个迭代的过程 。鼓励用户从基本的提示词开始，并根据AI的输出来逐步优化它们 。以下是针对任务不同方面的初始示例提示词：  

**示例1（基本说话者识别）：**

```
### 指令 ###
识别以下文本中每句话的说话者。如果说话者没有明确提及，请尝试从上下文中推断。

### 文本 ###
[在此插入小说章节文本]

### 输出格式 ###
以JSON对象数组的形式提供输出。每个对象应包含两个字段：“sentence”和“speaker”。
```

**示例2（基本语气/情绪分析）：**

```
### 指令 ###
识别以下文本中每句话的语气或情绪。从以下类别中选择：快乐、悲伤、愤怒、恐惧、好奇、正式、非正式、中性。

### 文本 ###
[在此插入小说章节文本]

### 输出格式 ###
以JSON对象数组的形式提供输出。每个对象应包含两个字段：“sentence”和“tone_mood”。
```

**示例3（结合说话者和语气/情绪的JSON输出）：**

```
### 指令 ###
分析以下文本，识别每句话的说话者和语气或情绪。如果说话者没有明确提及，请从上下文中推断。从以下类别中选择语气或情绪：快乐、悲伤、愤怒、恐惧、好奇、正式、非正式、中性。

### 文本 ###
[在此插入小说章节文本]

### 输出格式 ###
以JSON对象数组的形式输出您的分析结果。每个对象应包含以下字段：“sentence”（原始句子）、“speaker”（已识别的说话者）和“tone_mood”（已识别的语气或情绪）。

### 示例输出 ###
[
  {
    "sentence": "你好吗？",
    "speaker": "爱丽丝",
    "tone_mood": "友好"
  },
  {
    "sentence": "我很好，谢谢。",
    "speaker": "鲍勃",
    "tone_mood": "中性"
  }
]
```

提供具体的示例为用户提供了一个实验的起点。这些示例演示了如何在提示词中组合指令、上下文和期望的输出格式。

**9. 结论**

本报告总结了针对用户特定任务的提示词工程的关键原则。清晰的指令、特定的输出格式要求（尤其是JSON）以及提示词优化的迭代性质至关重要。用户应尝试提供的示例，并根据其特定需求和所分析小说的特点进行调整。用户可能还需要根据其具体的分析目标调整语气/情绪类别。希望本报告能够为用户成功实现其基于AI的长文本分析功能提供有力的支持。